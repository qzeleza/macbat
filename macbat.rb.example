# macbat.rb

class Macbat < Formula
  desc "Утилита для мониторинга и управления зарядом батареи на ноутбуке с macOS X"
  homepage "https://github.com/zeleza/macbat" # ЗАМЕНИТЕ НА ССЫЛКУ ВАШЕГО РЕПОЗИТОРИЯ
  url "https://github.com/zeleza/macbat/archive/refs/tags/v0.4.0.tar.gz" # ЗАМЕНИТЕ НА URL АРХИВА РЕЛИЗА
  version "0.4.0" # ЗАМЕНИТЕ НА ВАШУ ВЕРСИЮ
  sha256 "..." # ЗАМЕНИТЕ НА SHA256 ВАШЕГО АРХИВА

  depends_on "go" => :build

  def install
    # Собираем бинарный файл
    system "go", "build", "-o", "macbat", "./cmd/macbat"
    
    # Устанавливаем бинарный файл в /usr/local/bin
    bin.install "macbat"
  end

  def post_install
    # Запускаем приложение в первый раз после установки.
    # Оно само зарегистрирует необходимые службы в launchd.
    system bin/"macbat"
  end

  test do
    # Простой тест, который проверяет, что бинарник запускается и выводит версию.
    # Убедитесь, что в вашем приложении есть флаг --version.
    assert_match "macbat version", shell_output("#{bin}/macbat --version")
  end
end
